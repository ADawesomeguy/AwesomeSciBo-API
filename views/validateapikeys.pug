doctype html
head
  title Validate API Keys | AwesomeSciBo API
  style
    include styles/style.css
  script(src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous")
  script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous")

body
  div.container.w-100
    div.row.mt-3
    h5.text-center.mt-1.display-5 Validate API Keys Here:
    div.mb-3.text-align-center
      form(method="POST" action="/apikeys/validate")#verificationForm
        div.input-group.my-3
          input(type="text" name="Master API Key" placeholder="Master API Key" required)#masterapikey.form-control
          div.input-group-append
            input(type="submit" value="Submit").btn.btn-primary
      table.table
        thead
          tr
            th(scope="col") E-mail
            th(scope="col") API Key
            th(scope="col") Valid
        tbody
          each apiKey, index in apiKeyData
            tr
              td= apiKey['Email']
              td= apiKey['API Key']
              td
                button(id=index type="button" onclick="toggleValidity(this.id)").btn.btn-primary= apiKey['Valid']
      
  script.
    let apiKeys;
    let masterKey;
    window.onload = () => {
      if(!{JSON.stringify(apiKeyData)}.length > 0) {
        apiKeys = !{JSON.stringify(apiKeyData)};
        document.getElementById('verificationForm').remove();
      }
      if(!{JSON.stringify(masterAPIKey)}.length > 0) {
        masterKey = !{JSON.stringify(masterAPIKey)};
      }
    }
    
    function toggleValidity(id) {
      const row = document.getElementById(`${id}`).parentElement.parentElement.childNodes;
      const childValues = [];
      let jsonObj = {};
      row.forEach(child => {
        childValues.push(child.innerText);
        if (child.innerText === 'true') {
          child.innerHTML = '<button class="btn btn-primary" id=index type="button" onclick="toggleValidity(this.id)">false</button>';
        } else if (child.innerText === 'false') {
          child.innerHTML = '<button class="btn btn-primary" id=index type="button" onclick="toggleValidity(this.id)">true</button>';
        }
      });
      jsonObj['Master API Key'] = masterKey;
      jsonObj['Email'] = childValues[0];
      jsonObj['API Key'] = childValues[1];
      if (childValues[2] === 'false') {
        jsonObj['Valid'] = true;
      } else {
        jsonObj['Valid'] = false;
      }
      const email = document.getElementById("")
      const xhttp = new XMLHttpRequest();
      xhttp.open("POST", "/apikeys/validate");
      xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      xhttp.send(JSON.stringify(jsonObj));
    }
